## ТЗ VK Tech

Необходимо спроектировать и разработать Django-сервис друзей.
Сервис должен предоставлять возможности:
- зарегистрировать нового пользователя
- оправлять одному пользователю заявку в друзья другому
- принять/отклонить пользователю заявку в друзья от другого пользователя
- посмотреть пользователю список своих исходящих и входящих заявок в друзья
- посмотреть пользователю список друзей
- получать пользователю статус дружбы с каким-то другом пользователем (нет ничего/есть исходящая заявка/есть входящая заявка/ уже друзья)
- удалить пользователю другого пользователя из своих друзей
- если пользователь 1 отправляет заявку в друзья пользователю 2, а пользователь 2 отправляет заявку пользователю 1, то они автоматически становятся друзьями, их заявки автоматом принимаются.

Модель пользователя может быть самой простой:
- id
- username

Необходимо:
- описать REST интерфейс сервиса с помощью OpenAPI
- написать на Django сервис по этой спецификации
- описать краткую документацию с примерами запуска сервиса и вызова его API
+unit-тесты будут плюсом
+Dockerfile для упаковки в контейнер будет плюсом

Входные артефакты:
- исходный код
- OpenAPI спецификация
- документация с описанием запуска и примерами использования API

## Используемые технологии
- Python 3.11 
- Django 4.2
- django-ninja 0.21.0

1. склонировать репозиторий
2. создать виртуальное окружение `python3 -m venv venv` 
3. активировать виртуальное окружение `source venv/bin/activate`  
4. создать файл `.env` примерные данные можно взять из `.env.sample` 
5. `pip install -r friendship/requirements.txt` - установить необходимые библиотеки.
6. `make build` - собрать докер образы приложения, админки и бд.
7. `docker exec -it web /bin/bash` - зайти в контейнер с приложением
8. `python3 manage.py makemigrations` - зафиксировать миграции
9. `python3 manage.py migrate` - применить миграции
10. `python3 manage.py createsuperuser` - создать админа (чтобы был) (далее следовать инструкциям джанги)
11. `exit` - выйти из контейнера.
12. перейти по `127.0.0.1:8000/api/v1/docs` - откроется страница с документацией openapi.


## Варианты запуска
1. выполнить шаги по установке
2. в файле `docker-compose.yml` закомментировать образ приложения `web`.
3. у сервиса `db` раскомментировать порты
4. в настройках Django `friends/settings.py` у словаря 'default' списка `DATABASES` раскомментировать `'HOST': localhost'` и закомментировать `'HOST': os.environ.get('DB_HOST')`.
5. `make build` - собрать образ базы данных и её админки.
6. `make run` - запустить приложение.
7. `localhost:8080/` - адрес приложения, можно менять код и видеть результат мгновенно
8. `localhost:8081/` - адрес админки, там можно данные в бд смотреть.

## Как останавливать и запускать сервис
1. `make down` - остановить, если сервис запущен
2. `make up` - запустить, если сервис остановлен
3. `make build` - пересобрать docker образы.



- `/api/v1/docs` - openapi документация. Далее описана часть функционала.

**User** в сервисе имеет поля uuid, username, password, date_created, is_staff.
- `/api/v1/users/` - получить всех юзеров сервиса
- `/api/v1/register` - регистрация по username и password. Если ник не занят, то регистрируется новый юзер. Username может содержать только латинские буквы и цифры
- `/api/v1/login` - авторизация по username и password. Возвращается токен, который живёт по умолчанию 10 минут. Его нужно отправлять в хедере (`'HTTP_AUTHORIZATION': 'Bearer token.example'`) (в сваггере можно авторизоваться)
- `/api/v1/whoami` - возвращает username и uuid авторизованного пользователя.
- `/api/v1/friends/myfriends` - получить список своих друзей
- `/api/v1/friends/requests` - получить список исходящих и входящих заявок
- `/api/v1/friends/{user_id}/status` - получить статус дружбы с юзером по его user_id. Есть 4 статуса: **none**, **outgoing**, **incoming**, **friends**.
- `/api/v1/friends/{user_id}/add` - добавить юзера в друзья по его user_id. Если от этого юзера есть заявка в друзья, то статус дружбы с ним сменится с **incoming** на **friends**.
- `/api/v1/friends/{user_id}/remove` - удалить юзера из друзей / отменить заявку в друзья. Если юзер1 отправил заявку юзеру2, и юзер2 принял заявку, а потом юзер1 удалил юзера2 из друзей, то статус дружбы становится **none**. Если юзер1 отправил заявку юзеру2, и юзер2 принял заявку, а затем юзер2 передумал и удалил юзера1 из друзей, то заявка в друзья от юзера1 не удалится

